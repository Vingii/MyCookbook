@using Microsoft.AspNetCore.Localization;
@using MyCookbook.Services;
@using System.Web;
@inject ILogger<Feedback> Logger
@inject IDialogService DialogService
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar

<MudIconButton Icon="@Icons.Material.Filled.BugReport" Color="Color.Inherit" OnClick="@(async (e) => await OpenDialog())" Disabled="@DisableInteractivity" />

@code {
    private bool DisableInteractivity => NavigationManager.ToBaseRelativePath(NavigationManager.Uri).StartsWith("Account");

    private async Task OpenDialog()
    {
        try
        {
            var options = new DialogOptions { CloseOnEscapeKey = true, DisableBackdropClick = false };
            var dialog = await DialogService.ShowAsync<FeedbackDialog>("Feedback", options);
            var dialogResult = await dialog.Result;

            if (!dialogResult.Canceled && dialogResult.Data is FeedbackResult feedbackData)
            {
                if (feedbackData.Text == null || feedbackData.Text == string.Empty)
                {
                    Snackbar.Add("There was an error submitting your feedback.", Severity.Error);
                }
                else
                {
                    Snackbar.Add("Feedback submitted successfully!", Severity.Success);
                }
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Failed to submit feedback.");
            Snackbar.Add("There was an error submitting your feedback.", Severity.Error);
        }
    }
}