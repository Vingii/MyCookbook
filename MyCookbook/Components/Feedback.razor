@using Microsoft.AspNetCore.Localization;
@using MyCookbook.Services;
@using System.Web;
@inject ILogger<Feedback> Logger
@inject IFeedbackProvider FeedbackProvider
@inject IDialogService DialogService
@inject NavigationManager NavigationManager

<MudIconButton Icon="@Icons.Material.Filled.BugReport" Color="Color.Inherit" OnClick="@(async (e) => await OpenDialog())" Disabled="@DisableInteractivity" />

@code {
    private bool DisableInteractivity => NavigationManager.ToBaseRelativePath(NavigationManager.Uri).StartsWith("Account");

    private async Task OpenDialog()
    {
        try
        {
            var options = new DialogOptions { CloseOnEscapeKey = true };
            var dialog = await DialogService.ShowAsync<FeedbackDialog>("New recipe", options);
            var dialogResult = await dialog.Result;

            if (!dialogResult.Canceled)
            {
                await FeedbackProvider.ProvideFeedback(dialogResult.Data.ToString());
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Failed to provide feedback.");
        }
    }
}